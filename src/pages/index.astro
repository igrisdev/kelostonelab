---
import BeforeAndAfter from '@sections/home/BeforeAndAfter.astro'
import Layout from '@layouts/Layout.astro'
import PromoProducts from '@sections/home/PromoProducts.astro'
import ProductCollections from '@sections/home/ProductCollections.astro'
import FeaturedProducts from '@sections/home/FeaturedProducts.astro'
import FeaturedProduct from '@sections/home/FeaturedProduct.astro'
import Header from '@sections/home/Header.astro'

import { client } from '@services/connectionShopify'
import { productsQuery } from '@graphql/queries/products'

async function getProducts(first = 10) {
  try {
    const { data, errors, extensions } = await client.request(productsQuery, {
      variables: {
        first,
      },
    })

    if (errors) {
      console.error('Errores en la consulta:', errors)
    } else {
      console.log('Productos obtenidos:', data.products.edges)

      return data.products.edges
    }
  } catch (error) {
    console.error('Error ejecutando la consulta:', error)
  }
}

const products = await getProducts(10)
---

<Layout>
  <Header />
  <BeforeAndAfter />
  <PromoProducts />
  <ProductCollections />
  <FeaturedProducts />
  <FeaturedProduct />
  <p>{JSON.stringify(products)}</p>
</Layout>
